Here's an example C++ code that converts WGS84 coordinates to HK1980 grid system:

```cpp
#include
#include

using namespace std;

const double a = 6378137.0; // WGS84 semi-major axis
const double b = 6356752.3142; // WGS84 semi-minor axis
const double f = (a - b) / a; // WGS84 flattening
const double e2 = 2 * f - f * f; // WGS84 eccentricity squared
const double k0 = 0.9996; // HK1980 scale factor
const double dx = 819069.80; // HK1980 false easting
const double dy = 836694.05; // HK1980 false northing
const double lon0 = 114.1785555556; // HK1980 central meridian in degrees
const double lat0 = 22.3121333333; // HK1980 origin latitude in degrees

double deg2rad(double deg) {
return deg * M_PI / 180.0;
}

double rad2deg(double rad) {
return rad * 180.0 / M_PI;
}

void wgs84_to_hk1980(double lat, double lon, double& x, double& y) {
double phi = deg2rad(lat);
double lambda = deg2rad(lon);
double lambda0 = deg2rad(lon0);

double N = a / sqrt(1 - e2 * sin(phi) * sin(phi));
double T = tan(phi) * tan(phi);
double C = e2 * cos(phi) * cos(phi) / (1 - e2);
double A = (lambda - lambda0) * cos(phi);
double M = a * ((1 - e2 / 4 - 3 * e2 * e2 / 64 - 5 * e2 * e2 * e2 / 256) * phi
- (3 * e2 / 8 + 3 * e2 * e2 / 32 + 45 * e2 * e2 * e2 / 1024) * sin(2 * phi)
+ (15 * e2 * e2 / 256 + 45 * e2 * e2 * e2 / 1024) * sin(4 * phi)
- (35 * e2 * e2 * e2 / 3072) * sin(6 * phi));

x = k0 * (A + (1 - T + C) * pow(A, 3) / 6
+ (5 - 18 * T + T * T + 72 * C - 58 * e2) * pow(A, 5) / 120) + dx;
y = k0 * (M - N * tan(phi) * (pow(A, 2) / 2
- (5 + 3 * T + 10 * C - 4 * C * C - 9 * e2) * pow(A, 4) / 24
+ (61 + 90 * T + 298 * C + 45 * T * T - 252 * e2 - 3 * C * C) * pow(A, 6) / 720)) + dy;
}

int main() {
double lat = 22.279327;
double lon = 114.162813;
double x, y;

wgs84_to_hk1980(lat, lon, x, y);

cout << "WGS84: (" << lat << ", " << lon << ")" << endl;
cout << "HK1980: (" << x << ", " << y << ")" << endl;

return 0;
}
```

Note that this code assumes that the input latitude and longitude are in decimal degrees, and the output x and y coordinates are in meters. Also, the constants used in the conversion formula are specific to the Hong Kong 1980 grid system, and may need to be adjusted for other grid systems.
