WGS84经纬度转换为HK1980方格坐标的计算方法可以分为以下几步：

1. 将WGS84经纬度转换为大地坐标系

WGS84经纬度可以通过以下公式转换为大地坐标系中的经纬度：

φ = arctan((1 - f) * tan(λ))
L = atan2(tan(φ), cos(λ))

其中，φ表示纬度，λ表示经度，f表示椭球体扁率。

然后，可以使用大地坐标系中的转换公式将经纬度转换为大地坐标系中的X、Y、Z坐标：

X = (N + h) * cos(φ) * cos(λ)
Y = (N + h) * cos(φ) * sin(λ)
Z = (N * (1 - e^2) + h) * sin(φ)

其中，N表示卯酉圈曲率半径，h表示高度，e表示椭球体第一偏心率。

2. 将大地坐标系转换为平面坐标系

在HK1980坐标系中，通常使用的是“港澳格网”（Hong Kong Grid）或“港九格网”（Hong Kong 1980 Grid）来表示平面坐标。这些格网通常是基于UTM投影或高斯-克吕格投影的。

对于UTM投影，可以使用以下公式将大地坐标系中的X、Y、Z坐标转换为UTM投影下的坐标：

a = 6378137
f = 1 / 298.257223563
b = a * (1 - f)
e = sqrt(1 - (b / a)^2)
n = f / (2 - f)
v = a / sqrt(1 - e^2 * sin(φ)^2)
p = a * (1 - e^2) / (1 - e^2 * sin(φ)^2)^(3/2)
m = a * (1 - e^2) * (1 - e^2 * sin(φ)^2)^(-1.5)

A = (λ - λ0) * cos(φ)
t = tan(φ)
η = n / (v * m)
x = A^2 / 2 * v * m * sin(φ) * cos(φ)
y = A^4 / 24 * v * m * sin(φ) * cos(φ)^3 * (5 - t^2 + 9 * η^2 + 4 * η^4)
z = A^6 / 720 * v * m * sin(φ) * cos(φ)^5 * (61 - 58 * t^2 + t^4)

其中，a表示椭球体长半轴，f表示椭球体扁率，b表示椭球体短半轴，e表示椭球体第一偏心率，φ表示纬度，λ表示经度，λ0表示中央经线，n表示椭球体第三偏心率，v表示子午线曲率半径，p表示卯酉圈曲率半径，m表示子午线弧长半径，A表示经差，t表示切线，η表示斜率因子，x、y、z表示UTM投影下的坐标。

对于高斯-克吕格投影，可以使用以下公式将大地坐标系中的X、Y、Z坐标转换为高斯-克吕格投影下的坐标：

a = 6378137
f = 1 / 298.257223563
b = a * (1 - f)
e = sqrt(1 - (b / a)^2)
n = f / (2 - f)
v = a / sqrt(1 - e^2 * sin(φ)^2)
p = a * (1 - e^2) / (1 - e^2 * sin(φ)^2)^(3/2)
m = a * (1 - e^2) * (1 - e^2 * sin(φ)^2)^(-1.5)

λ0 = (zone - 1) * 6 - 180 + 3
L0 = (zone - 1) * 6 - 180 + 3

A = (λ - λ0) * cos(φ)
t = tan(φ)
η = n / (v * m)
x = p * cos(φ) * A * (1 + A^2 / 6 * (1 - t^2 + η^2))
y = p * (m + A^2 / 2 * t * (1 - t^2 + η^2) + A^4 / 24 * t * (5 - t^2 + 9 * η^2 + 4 * η^4))
z = 1

其中，a表示椭球体长半轴，f表示椭球体扁率，b表示椭球体短半轴，e表示椭球体第一偏心率，φ表示纬度，λ表示经度，zone表示投影带号，n表示椭球体第三偏心率，v表示子午线曲率半径，p表示卯酉圈曲率半径，m表示子午线弧长半径，λ0表示中央经线，L0表示投影中央经度，A表示经差，t表示切线，η表示斜率因子，x、y、z表示高斯-克吕格投影下的坐标。

3. 将平面坐标转换为方格坐标WGS84经纬度转换为HK1980方格坐标的计算方法可以分为以下步骤：

1. 将WGS84经纬度转换为大地坐标系（GCS_HK1980）。

这可以通过以下公式进行计算：

```
φ = latitude * π / 180
λ = longitude * π / 180
a = 6378137.0
f = 1 / 298.257223563
b = a * (1 - f)
e = sqrt((a**2 - b**2) / a**2)
N = a / sqrt(1 - e**2 * sin(φ)**2)
X = (N + altitude) * cos(φ) * cos(λ)
Y = (N + altitude) * cos(φ) * sin(λ)
Z = (N * (1 - e**2) + altitude) * sin(φ)
```

其中，`latitude`和`longitude`分别表示WGS84坐标系下的纬度和经度，`altitude`表示高程（如果不知道高程，则可以将其设为0）。`a`和`b`分别表示WGS84椭球体的长半轴和短半轴，`f`表示椭球体扁率，`e`表示椭球体第一偏心率，`N`表示卯酉圈曲率半径，`X`、`Y`和`Z`分别表示大地坐标系下的X、Y和Z坐标。

2. 将大地坐标系转换为平面坐标系。

在HK1980坐标系中，通常使用的是“港澳格网”（Hong Kong Grid）或“港九格网”（Hong Kong 1980 Grid）来表示平面坐标。这些格网通常是基于UTM投影或高斯-克吕格投影的，因此需要使用相应的投影参数进行转换。

以高斯-克吕格投影为例，可以使用以下公式进行计算：

```
a = 6378388.0
f = 1 / 297.0
b = a * (1 - f)
e = sqrt((a**2 - b**2) / a**2)
φ0 = 22.3121333333333 * π / 180
λ0 = 114.178555555556 * π / 180
k0 = 1
N0 = 819069.8
E0 = 836694.05
λ = atan(Y / X)
ρ = sqrt(X**2 + Y**2)
η2 = e**2 * cos(φ)**2
M = a * (1 - e**2) / (1 - e**2 * sin(φ)**2)**1.5
N = a / sqrt(1 - e**2 * sin(φ)**2)
t = tan(φ)
t2 = t**2
t4 = t**4
t6 = t**6
C = e**2 / (1 - e**2) * cos(φ)**2
A = (λ - λ0) * cos(φ)
A2 = A**2
A3 = A**3
A5 = A**5
A7 = A**7
E = E0 + k0 * N * (A + A3 / 6 * (1 - t2 + C) + A5 / 120 * (5 - 18 * t2 + t4 + 72 * C - 58 * η2) + A7 / 5040 * (61 - 479 * t2 + 179 * t4 - t6))
N = N0 + k0 * (M + t2 * N / 2 * (A2 + (5 - t2 + 9 * C + 4 * C**2) * A4 / 24 + (61 - 58 * t2 + t4 + 600 * C - 330 * η2) * A6 / 720))
```

其中，`a`和`b`分别表示HK1980椭球体的长半轴和短半轴，`f`表示椭球体扁率，`e`表示椭球体第一偏心率，`φ0`和`λ0`分别表示投影中央经线和纬线，`k0`表示比例因子，`N0`和`E0`分别表示投影坐标系下的原点纬度和经度，`λ`表示投影后的经度，`ρ`表示投影后的半径，`η2`表示投影后的第二偏心率，`M`表示子午线弧长，`N`表示卯酉圈曲率半径，`t`表示投影后的纬度切线，`C`表示投影后的子午线曲率半径，`A`表示投影后的横向坐标，`E`和`N`分别表示投影后的东西向和南北向坐标。

3. 将平面坐标转换为方格坐标。

在HK1980坐标系中，方格坐标通常是以“X-Y”形式表示的，其中X和Y分别表示格网中的列和行。因此，需要将平面坐标转换为相应的列和行坐标，即可得到HK1980方格坐标。

需要注意的是，由于WGS84和HK1980使用的基准面和坐标系不同，因此在进行坐标转换时可能存在一定的误差。因此，在进行精确的坐标转换时，建议使用专业的GIS软件或咨询相关专业人士。
